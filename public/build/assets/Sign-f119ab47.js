import{r as i,j as s,a as e,F,W as $,l as ee,h as ae,b as te}from"./app-87882047.js";import{I as _}from"./InputLabel-5b81b489.js";import{M as T}from"./Modal-7b2a12aa.js";import{B as E}from"./Button-2a3e8570.js";import{I as v}from"./Icon-74cb44c4.js";import{I as re}from"./InputError-20e0cd2c.js";import{c as Y}from"./clsx.m-1229b3e0.js";import{I as Q}from"./index-3820ea62.js";import{I as ne}from"./InputFileViewer-083cf75d.js";import{A as le}from"./AppLayout-d46e816a.js";import{c as se,p as ie}from"./animation-f20c107f.js";import{a as oe,S as ce}from"./Section-84195aa3.js";import{T as q}from"./TextInput-71e6462b.js";import{m as de,s as pe}from"./SignServices-94a29478.js";import{Q as U}from"./react-toastify.esm-801a0bbd.js";import{A as ue}from"./AppContentLayout-9d50da8b.js";/* empty css                      */import"./transition-8e202e22.js";import"./Compact-901ea82d.js";import"./sweetalert2.all-1005328a.js";import"./Dropdown-ff7981c9.js";var z=globalThis&&globalThis.__assign||function(){return z=Object.assign||function(a){for(var n,l=1,t=arguments.length;l<t;l++){n=arguments[l];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(a[r]=n[r])}return a},z.apply(this,arguments)},fe=globalThis&&globalThis.__rest||function(a,n){var l={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&n.indexOf(t)<0&&(l[t]=a[t]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(a);r<t.length;r++)n.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(a,t[r])&&(l[t[r]]=a[t[r]]);return l},K=se("ClockLoader","100% { transform: rotate(360deg) }","rotate");function H(a){var n=a.loading,l=n===void 0?!0:n,t=a.color,r=t===void 0?"#000000":t,f=a.speedMultiplier,d=f===void 0?1:f,m=a.cssOverride,k=m===void 0?{}:m,N=a.size,g=N===void 0?50:N,S=fe(a,["loading","color","speedMultiplier","cssOverride","size"]),u=ie(g),p=u.value,y=u.unit,w=z({display:"inherit",position:"relative",width:"".concat(p).concat(y),height:"".concat(p).concat(y),backgroundColor:"transparent",boxShadow:"inset 0px 0px 0px 2px ".concat(r),borderRadius:"50%"},k),C={position:"absolute",backgroundColor:r,width:"".concat(p/3,"px"),height:"2px",top:"".concat(p/2-1,"px"),left:"".concat(p/2-1,"px"),transformOrigin:"1px 1px",animation:"".concat(K," ").concat(8/d,"s linear infinite")},b={position:"absolute",backgroundColor:r,width:"".concat(p/2.4,"px"),height:"2px",top:"".concat(p/2-1,"px"),left:"".concat(p/2-1,"px"),transformOrigin:"1px 1px",animation:"".concat(K," ").concat(2/d,"s linear infinite")};return l?i.createElement("span",z({style:w},S),i.createElement("span",{style:b}),i.createElement("span",{style:C})):null}function me({disabled:a=!1,handleModalClose:n}){return s("div",{className:"flex justify-center gap-5",children:[s(E,{size:"sm",variant:"danger",className:"w-[150px]",onClick:n,children:[e(v,{icon:"x-lg",className:"me-2 text-sm"}),"Batal"]}),s(E,{type:"submit",size:"sm",className:"w-[150px]",disabled:a,children:[e(v,{icon:"pencil-square",className:"me-2 text-sm"}),"Tanda Tangan"]})]})}function he({modalOpen:a,submit:n,handleModalClose:l,handleChange:t,data:r,errors:f}){return e(T,{show:a,children:s("form",{className:"flex flex-col gap-5",onSubmit:n,children:[e(T.Header,{onClick:l,children:"Tanda Tangani Dokumen"}),s(T.Body,{className:"flex flex-col gap-5",children:[s("div",{className:"flex flex-col gap-2 w-full",children:[e(_,{required:!0,children:"Perihal"}),e(Q,{name:"perihal",placeholder:"Masukkan Perihal",onChange:t,defaultValue:r.perihal,className:Y(f.perihal&&"border-red-500","py-2"),required:!0}),e(re,{message:f.perihal})]}),s("div",{className:"flex flex-col gap-2 w-full",children:[e(_,{required:!0,children:"Passphrase"}),e(Q.Password,{name:"passphrase",placeholder:"Masukkan Passphrase",onChange:t,className:"py-2",required:!0})]})]}),e(T.Footer,{children:e(me,{disabled:!r.perihal||!r.passphrase||r.passphrase.length<6,handleModalClose:l})})]})})}function W({disabled:a=!1,handleModalOpen:n,file:l,resetFile:t}){return s("div",{className:"flex justify-between gap-5 mb-15",children:[s(E,{size:"sm",variant:"danger",className:"w-[150px]",onClick:t,disabled:!l,children:[e(v,{icon:"arrow-clockwise",className:"me-2 text-sm"}),"Reset File"]}),s(E,{size:"sm",className:"w-[150px]",onClick:n,disabled:a,children:[e(v,{icon:"arrow-right",className:"me-2 text-sm"}),"Lanjutkan"]})]})}function X(){return s(F,{children:[s("div",{className:"bg-yellow-100 p-3 rounded-xl flex lg:flex-col gap-3",children:[e(v,{icon:"file-earmark-pdf",className:"text-3xl"}),s("span",{children:["File yang diizinkan untuk melakukan tanda tangan digital adalah yang berekstensi ",e("strong",{children:".pdf"})]})]}),e("div",{className:"hidden lg:block ",children:e("div",{className:"flex flex-col justify-center h-auto mt-10 gap-5 md:py-10",children:e("div",{className:"flex justify-center",children:s("div",{className:"flex flex-col justify-center items-center gap-10 border-4 border-color-primary rounded-full w-[200px] h-[200px] text-[50px] font-bold",children:[e("span",{className:"text-color-primary",children:"Sign"}),e("span",{className:"text-color-secondary",children:"chain"})]})})})})]})}function ge({file:a,errors:n,handleFileChange:l,disabledSelectFile:t}){return s(F,{children:[e("label",{htmlFor:"file",className:Y(n.file?"border-red-500":"border-color-secondary","border  rounded-3xl flex justify-center items-center h-[550px] cursor-pointer hover:bg-gray-100"),children:e("div",{className:"flex flex-col items-center gap-3",children:n.file?s(F,{children:[e(v,{icon:"exclamation-triangle",className:"text-[40px] text-red-500"}),e("span",{className:"text-red-500 text-base",children:n.file})]}):s(F,{children:[e(v,{icon:"file-earmark-pdf",className:"text-[40px] text-gray-300"}),e("span",{className:"text-gray-300 text-base",children:t?"Browser Anda belum terinstall metamask":"Pilih Dokumen"})]})})}),e("input",{id:"file",type:"file",className:"hidden",onChange:l,disabled:t})]})}function xe({handleFileChange:a,resetFile:n,errors:l,file:t,filePreview:r,handleModalOpen:f,disabledSelectFile:d}){return s("div",{className:"flex flex-col gap-5",children:[t&&r?e(ne,{file:r||t,isPreview:r}):e(F,{children:e(ge,{handleFileChange:a,errors:l,disabledSelectFile:d})}),t?e("div",{className:"lg:hidden",children:e(W,{resetFile:n,handleModalOpen:f,file:t,disabled:!t||l.file||l.page||l.x||l.y})}):null]})}function ye({loading:a=!0}){return e(le,{children:e("div",{className:"flex flex-col justify-center gap-5 h-full md:py-10",children:e("div",{className:"flex justify-center",children:s("div",{className:"flex flex-col gap-4 justify-center items-center",children:[e(H,{color:"#009B4D",loading:a,size:100,"aria-label":"Loading Spinner","data-testid":"loader"}),e("span",{className:"text-color-primary text-lg",children:"Signing..."})]})})})})}function be({updateQrCode:a,qrCode:n,pageRef:l,XRef:t,YRef:r}){return s("div",{className:"flex flex-col gap-2",children:[e(oe,{title:"Atur Posisi QRCode"}),s("form",{onSubmit:a,className:"grid grid-cols-4 items-end gap-2",children:[s("div",{className:"flex flex-col gap-1",children:[e(_,{children:"Page"}),e(q,{type:"number",placeholder:"Page",defaultValue:n.page,ref:l})]}),s("div",{className:"flex flex-col gap-1",children:[e(_,{children:"Koordinat X"}),e(q,{type:"number",placeholder:"Koordinat X",defaultValue:n.x,ref:t})]}),s("div",{className:"flex flex-col gap-1",children:[e(_,{children:"Koordinat Y"}),e(q,{type:"number",placeholder:"Koordinat Y",defaultValue:n.y,ref:r})]}),e(E,{size:"sm",type:"submit",children:"Update"})]})]})}function ve(a,n){const[l,t]=i.useState(!1);i.useState("");const[r,f]=i.useState(!1),{data:d,setData:m,post:k,processing:N,errors:g,reset:S}=$({perihal:"",passphrase:"",file:null}),[u,p]=i.useState(null),[y,w]=i.useState(!1),C=()=>{w(!0)},b=()=>{w(!1)},P=o=>{const h=o.target.files[0];p(h),m("file",h)},B=ee.debounce(o=>{m(o.target.name,o.target.value)},500);i.useEffect(()=>{de()},[]);async function L(){const o=new Web3(window.ethereum),O=(await window.ethereum.request({method:"eth_requestAccounts"}))[0],j=await I(d.filePreview),x=o.utils.sha3(j),D=await pe(o,x,O);console.log("raw",x),m({...d,blockchain_document_hash:x,blockchain_signature:D})}async function I(o){return fetch(o).then(h=>{if(!h.ok)throw new Error("Network response was not ok");return h.arrayBuffer()}).then(h=>{const O=new Uint8Array(h);return Array.from(O).map(x=>String.fromCharCode(x)).join("")})}i.useEffect(()=>{l&&(L(),t(!1))},[l]);const M=o=>{o.preventDefault(),t(!0)};return i.useEffect(()=>{var o;((o=d.blockchain_signature)==null?void 0:o.length)>0&&(k(route("sign.handle_sign"),{onError:()=>{b(),U.error("Gagal, silahkan cek kembali formnya.",{theme:"colored"})},preserveState:!0,preserveScroll:!0}),m("blockchain_signature",null))},[d.blockchain_signature]),i.useEffect(()=>{a.error&&U.error(a.error,{theme:"colored"}),a.success&&(b(),S(),n(),U.success(a.success,{theme:"colored"}))},[a]),{data:d,setData:m,processing:N,errors:g,reset:S,file:u,setFile:p,handleChange:B,handleFileChange:P,submit:M,modalOpen:y,handleModalOpen:C,handleModalClose:b,disabledSelectFile:r}}function qe({title:a,flash:n}){const[l,t]=i.useState(!1),[r,f]=i.useState(!1),d=()=>{p(null),t(null),R({file:"",page:"",x:"",y:""})},{data:m,setData:k,processing:N,errors:g,reset:S,file:u,setFile:p,handleChange:y,handleFileChange:w,submit:C,modalOpen:b,handleModalOpen:P,handleModalClose:B,disabledSelectFile:L}=ve(n,d),I=i.useRef(),M=i.useRef(),o=i.useRef(),[h,O]=i.useState({file:null,page:1,x:120,y:242}),[j,x]=i.useState(!1),[D,R]=i.useState({file:"",page:"",x:"",y:""}),G=V=>{V.preventDefault();const A=I.current.value,c=M.current.value,Z=o.current.value;O({page:A,x:c,y:Z}),x(!0)};i.useEffect(()=>{(j||u)&&J(u)},[j,u]);const J=async V=>{const A={...h,file:V};f(!0);try{const c=await ae.post(route("sign.update_qrcode"),A,{headers:{"Content-Type":"multipart/form-data"}});c.data.success&&(x(!1),R({file:"",page:"",x:"",y:""}),t(c.data.data.dokumen),k({...A,filePreview:c.data.data.dokumen}))}catch(c){c.response?R({file:c.response.data.data.file&&c.response.data.data.file[0],page:c.response.data.data.page&&c.response.data.data.page[0],x:c.response.data.data.x&&c.response.data.data.x[0],y:c.response.data.data.y&&c.response.data.data.y[0]}):console.log(c.message)}f(!1)};return N?e(ye,{}):s(ue,{active:a,title:a,children:[e(te,{title:a}),s(ce,{children:[s("div",{className:"flex flex-col lg:grid grid-cols-2 gap-5",children:[u?D.file?e("div",{children:e(X,{})}):s("div",{children:[e(be,{updateQrCode:G,qrCode:h,pageRef:I,XRef:M,YRef:o}),e("div",{className:"hidden lg:block mt-5",children:e(W,{resetFile:d,handleModalOpen:P,file:u,disabled:!u||g.file||g.page||g.x||g.y})})]}):e("div",{children:e(X,{})}),r?e("div",{className:"flex justify-center items-center h-[300px]",children:e(H,{color:"#009B4D",loading:r,size:150,"aria-label":"Loading Spinner","data-testid":"loader"})}):e(xe,{handleChange:y,handleFileChange:w,errors:D,data:m,resetFile:d,file:u,filePreview:l,handleModalOpen:P,disabledSelectFile:L})]}),e(he,{modalOpen:b,handleModalClose:B,submit:C,handleChange:y,data:m,errors:g})]})]})}export{qe as default};
